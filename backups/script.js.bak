// نظام الاشتراك البسيط (بدون دفع حقيقي)
document.addEventListener('DOMContentLoaded', function() {
    const premiumBtn = document.getElementById('premiumBtn');
    const annualBtn = document.getElementById('annualBtn');

    if (premiumBtn) {
        premiumBtn.addEventListener('click', function() {
            openSubscriptionModal('monthly');
        });
    }

    if (annualBtn) {
        annualBtn.addEventListener('click', function() {
            openSubscriptionModal('annual');
        });
    }

    function openSubscriptionModal(planType) {
        const planName = planType === 'monthly' ? 'الشهرية' : 'السنوية';
        const planPrice = planType === 'monthly' ? '$4.99' : '$49.99';
        
        const userResponse = confirm(`سيتم redirect بك إلى صفحة الدفع للاشتراك في الخطة ${planName} بسعر ${planPrice}. هل تريد المتابعة؟`);
        
        if (userResponse) {
            // محاكاة عملية الدفع
            showPaymentProcessing();
            
            setTimeout(() => {
                // 80% فرصة نجاح الدفع
                const success = Math.random() > 0.2;
                
                if (success) {
                    alert('✅ تم الاشتراك بنجاح! يمكنك الآن استخدام جميع المميزات المتميزة.');
                    activatePremiumFeatures();
                } else {
                    alert('❌ فشلت عملية الدفع. يرجى المحاولة مرة أخرى أو استخدام طريقة دفع أخرى.');
                }
            }, 2000);
        }
    }

    function showPaymentProcessing() {
        const overlay = document.createElement('div');
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
            font-size: 18px;
        `;
        overlay.innerHTML = `
            <div style="text-align: center;">
                <div style="width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                <p>جاري معالجة الدفع...</p>
            </div>
            <style>
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            </style>
        `;
        
        document.body.appendChild(overlay);
        
        setTimeout(() => {
            if (document.body.contains(overlay)) {
                document.body.removeChild(overlay);
            }
        }, 2000);
    }

    function activatePremiumFeatures() {
        localStorage.setItem('isPremiumUser', 'true');
        localStorage.setItem('premiumUntil', Date.now() + (30 * 24 * 60 * 60 * 1000));
        
        // تحديث الواجهة
        updateUIForPremiumUser();
        
        setTimeout(() => {
            window.location.reload();
        }, 2000);
    }

    function updateUIForPremiumUser() {
        if (premiumBtn) {
            premiumBtn.innerHTML = '<i class="fas fa-crown"></i> مميز';
            premiumBtn.classList.remove('primary');
            premiumBtn.style.background = '#27ae60';
            premiumBtn.onclick = null;
        }
        
        if (annualBtn) {
            annualBtn.style.display = 'none';
        }
    }

    // التحقق من حالة المستخدم عند تحميل الصفحة
    function checkUserStatus() {
        const isPremium = localStorage.getItem('isPremiumUser');
        const premiumUntil = localStorage.getItem('premiumUntil');
        
        if (isPremium === 'true' && premiumUntil && Date.now() < parseInt(premiumUntil)) {
            updateUIForPremiumUser();
        }
    }

    checkUserStatus();
});
